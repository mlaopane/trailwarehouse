<?php

namespace TrailWarehouse\AppBundle\Repository;
use TrailWarehouse\AppBundle\Entity\Family;
use TrailWarehouse\AppBundle\Entity\Category;
use Doctrine\ORM\EntityRepository;

/**
 * FamilyRepository
 *
 * This class was generated by the Doctrine ORM. Add your own custom
 * repository methods below.
 */
class FamilyRepository extends EntityRepository
{
  /**
   * @param {Array(Category)}
   * @return {Array(Family)}
   */
  public function findByCategories(Array $categories) {
    $builder = $this->_em->createQueryBuilder();
    $builder
      ->select('family')
      ->from($this->_entityName, 'family')
      ->innerJoin('family.categories', 'category')
    ;
    foreach ($categories as $index => $category) {
      $builder
        ->orWhere('category.name = ?'. ($index + 1))
        ->setParameter(($index + 1), $category->getName())
      ;
    }
    return $builder
      ->getQuery()
      ->getResult()
    ;
  }
}
